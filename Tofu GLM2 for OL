#Creating an GLM to test for associations between individual variables and sales and significant interactions
#No additional package installs needed

Tofu<-read.csv("Tofu2.csv")
attach(Tofu)
Tofu$sales<-as.numeric(Tofu$sales)
Tofu<-Tofu[!is.na(Tofu$sales),] #Make sure each row in the dataset has a sales value

Tofu$major_holiday<-as.factor(Tofu$major_holiday)
Tofu$other_holidays<-as.factor(Tofu$other_holidays)
Tofu$Friday_Shipping<-as.factor(Tofu$Friday_Shipping)
Tofu$Other_Site<-as.factor(Tofu$Other_Site)
Tofu$Flavor<-as.factor(Tofu$Flavor)
Tofu$Promotion<-as.factor(Tofu$Promotion)
Tofu$Private_Label<-as.factor(Tofu$Private_Label)
Tofu$Club<-as.factor(Tofu$Club)

Tofu$Retail<-as.factor(Tofu$Retail)
Tofu$Canada<-as.factor(Tofu$Canada)
Tofu$NE<-as.factor(Tofu$NE)
Tofu$SE<-as.factor(Tofu$SE)
Tofu$Temporary<-as.factor(Tofu$Temporary)
Tofu$New<-as.factor(Tofu$New)

GLM1<-glm(sales~SE+NE+Canada+Promotion+Retail+Size+major_holiday+other_holidays+season+Temporary+New+Texture+Flavor+Club+Friday_Shipping+Private_Label+Other_Site, data=Tofu,family="poisson")

#We tell R we are using a Poisson distribution so that it knows sales is a count variable

summary(GLM1)
#We sequentially drop non significant variables (P value over 0.05) with the highest P values then reevaluate the model until only significant variables remain.
GLM2 <- update(GLM1, .~.-Club)
anova(GLM1,GLM2) #If the P value for an ANOVA is <0.05, we would retain the variable
summary(GLM2)
GLM3 <- update(GLM2, .~.-Private_Label)
anova(GLM2,GLM3)
summary(GLM3)
GLM4 <- update(GLM3, .~.-Promotion)
anova(GLM3,GLM4)
summary(GLM4)

#Final model reached
