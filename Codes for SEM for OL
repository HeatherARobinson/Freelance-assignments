#Creating an SEM to describe the relationship between manifest variables and latent umbrella constructs
#Using the Lavaan package

Tofu<-read.csv("Tofu.csv")
New<-as.factor(New)
Temp<-as.factor(Temp)
SE<-as.factor(SE)
NE<-as.factor(NE)
Canada<-as.factor(Canada)
Food_service<-as.factor(Food_service)
Retail<-as.factor(Retail)
Club<-as.factor(Club)
Private_label<-as.factor(Private_label)
Friday_ship<-as.factor(Friday_ship)
Major_holiday<-as.factor(Major_holiday)
Other_holiday<-as.factor(Other_holiday)
Waterpack<-as.factor(Waterpack)

library(psych)
fa.poly

library(Lavaan)

#Each model should contain at least 3 variables so that the latent variable can be estimated
#because the degrees of freedom are based on the variables, not on sample size.
#Do not construct a model that has 0 degrees of freedom

#Define the model:
# example: model<-'latent_variable =~manifest_variable1 + manifest_variable2 + manifest_variable3'
pref.model<-'Customer_preference =~Waterpack + Texture + Size + Promotion'

#The model can either be scaled by setting the variance of the latent variable to 1, and dividing this between the manifest variables
#OR we can set the variance of one of the manifest variables to 1 (more commonly used approach). This is the Lavaan default.

#Now fit the model (run a factor analysis to check how well the manifest variables explain the latent variable):
pref.fit<-cfa(model=pref.model, data=Tofu)
summary(pref.fit)
