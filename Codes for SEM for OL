#Creating an SEM to describe the relationship between manifest variables and latent umbrella constructs
#Using the Lavaan package

#First, a basic factor analysis

library(Lavaan)

#Each model should contain at least 3 variables so that the latent variable can be estimated
#because the degrees of freedom are based on the variables, not on sample size.
#Do not construct a model that has 0 degrees of freedom

#Define the model:
# example: model<-'latent_variable =~manifest_variable1 + manifest_variable2 + manifest_variable3'
pref.model<-'Customer_preference =~Waterpack + Texture + Size + Promotion'

#The model can either be scaled by setting the variance of the latent variable to 1, and dividing this between the manifest variables
#OR we can set the variance of one of the manifest variables to 1 (more commonly used approach). This is the Lavaan default.

#Now fit the model (run a factor analysis to check how well the manifest variables explain the latent variable):
pref.fit<-cfa(model=pref.model, data=Tofu)
summary(pref.fit)
